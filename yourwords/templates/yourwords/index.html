{% extends 'yourwords/base.html' %}
{% load i18n %}
{% load staticfiles %}

{% block content %}

{% if records_data %}
	<script>
		$(function() {
			var records_data = {{ records_data|safe }}
			function getDataFromDatabase(fieldToShow)
			{
				var random_record = Math.floor((Math.random() * records_data.record_count) + 0)
				cleanFields()
			    var id = records_data.record_list[random_record].id
				var polish = records_data.record_list[random_record].polish
				var english = records_data.record_list[random_record].english
				var sentence = records_data.record_list[random_record].sentence
				var rating = records_data.record_list[random_record].rating
				$(".field_word_id").text(id)
				$(".field_polish_polish").text(polish)
				$(".field_polish_english").text(polish)
				$(".field_english_polish").text(english)
				$(".field_english_english").text(english)
				$(".field_sentence_polish").text(sentence)
				$(".field_sentence_english").text(sentence)
				$("." + fieldToShow + ", .rating").fadeIn().css('cursor', 'pointer')
			}
		
			$(".rand_polish").on('click', function() {
				getDataFromDatabase('field_polish_polish')
			});
			$(".field_polish_polish").on('click', function() {
				$(".field_polish_polish").css('cursor', 'default')
				$(".field_english_polish").fadeIn().css('cursor', 'pointer')
			})
			$(".field_english_polish").on('click', function() {
				$(".field_english_polish").css('cursor', 'default')
				if($('.field_sentence_polish').text() == '')
				{
					getDataFromDatabase('field_polish_polish')
				}
				else
				{
					$(".field_sentence_polish").fadeIn().css('cursor', 'pointer')
				}
			})
			$(".field_sentence_polish").on('click', function() {
				getDataFromDatabase('field_polish_polish')
			})

			$(".rand_english").on('click', function() {
				getDataFromDatabase('field_english_english')
			});
			$(".field_english_english").on('click', function() {
				$(".field_english_english").css('cursor', 'default')
				$(".field_polish_english").fadeIn().css('cursor', 'pointer')
			})
			$(".field_polish_english").on('click', function() {
				$(".field_polish_english").css('cursor', 'default')
				if($('.field_sentence_english').text() == '')
				{
					getDataFromDatabase('field_english_english')
				}
				else
				{
					$(".field_sentence_english").fadeIn().css('cursor', 'pointer')
				}
			})
			$(".field_sentence_english").on('click', function() {
				getDataFromDatabase('field_english_english')
			})
		})
	</script>
{% endif %}

{% if user.is_authenticated %}

<script>
	$(function() {
		///otwarcie okana w3-modal "rating" celem oznaczenia poziomu trudności słówka
		$('.rating').click(function() {
			$('.modal-rating').show()
			$('#rating-form input[type="radio"]').click(function()
			{
				$('#submit-rating-btn-ang').css({'visibility': 'visible'})
			})

			$('#rating-form').submit(function(e){
				e.preventDefault()
				var id = $(".field_word_id").text()
				var rating = $('input[name="rating"]:checked').val()
				$.ajax({
					type: 'POST',
					url: '{% url "yourwords:ajax_edit_rating" %}',
					dataType: 'json',
					data: {
						id: id,
						rating: rating
					}
				}).done(function(data) {
					if(data.success == 1)
					{
						$('#rating-form').trigger('reset')
						$('#submit-rating-btn-ang').css({'visibility': 'hidden'})
						$('.modal-rating').hide()
					}
				}).fail(function(){

				})
			})
		})
	})
</script>

	<div class="w3-modal modal-rating">
		<div class="w3-modal-content w3-card-2">
			<header class="w3-container w3-padding w3-blue modal-rating-header">{% trans 'Oznacz poziom trudności słówka' %}<div class="w3-display-topright"><i class="material-icons modal-close modal-rating-close">close</i></div></header>
			<div class="w3-container w3-padding w3-light-grey w3-lato-regular modal-rating-content">
				<form method="POST" action="{% url 'yourwords:ajax_edit_rating' %}" id="rating-form">
				{% csrf_token %}
					<label for="rating1" class="w3-validate w3-text-blue">{% trans 'Łatwy' %}</label>
					<input type="radio" name="rating" value="1" class="w3-radio" id="rating1">
					<label  for="rating2" class="w3-validate w3-text-blue">{% trans 'Średni' %}</label>
					<input type="radio" name="rating" value="2" class="w3-radio" id="rating2"> 
					<label  for="rating3"class="w3-validate w3-text-blue">{% trans 'Trudny' %}</label>
					<input type="radio" name="rating" value="3" class="w3-radio" id="rating3">
					<button type="submit" class="w3-btn w3-medium w3-blue w3-hover-white" id="submit-rating-btn-ang">OK</button>
				</form>
			</div>
		</div>
	</div>

{% endif %}


	<div class="rand">
		<div class="w3-row">
			<div class="w3-rest">
				<div class="w3-card-2 w3-red w3-center rand_polish" title="{% trans 'Losuj słówko polskie' %}">P</div>
			</div>
		</div>
		<div class="w3-row">
			<div class="w3-rest">
				<div class="w3-card-2 w3-blue w3-center rand_english" title="{% trans 'Losuj słówko języka obcego' %}">F</div>
			</div>
		</div>
	</div>
	<div class="words">
		<div class="w3-row">
			<div class="w3-rest">
				<div class="field_word_id" style="display:none;"></div>
			</div>
		</div>
		<div class="w3-row">
			<div class="w3-rest">
				<div class="w3-card-2 w3-green w3-text-light-grey w3-center field_polish_polish"></div>
			</div>
		</div>
		<div class="w3-row">
			<div class="w3-rest">
				<div class="w3-card-2 w3-orange w3-text-light-grey w3-center field_english_polish"></div>
			</div>
		</div>
		<div class="w3-row">
			<div class="w3-rest">
				<div class="w3-card-2 w3-orange w3-text-light-grey w3-center field_english_english"></div>
			</div>
		</div>
		<div class="w3-row">
			<div class="w3-rest">
				<div class="w3-card-2 w3-green w3-text-light-grey w3-center field_polish_english"></div>
			</div>
		</div>
		<div class="w3-row">
			<div class="w3-rest">
				<div class="w3-card-2 w3-teal w3-text-light-grey w3-center field_sentence_polish"></div>
			</div>
		</div>
		<div class="w3-row">
			<div class="w3-rest">
				<div class="w3-card-2 w3-teal w3-text-light-grey w3-center field_sentence_english"></div>
			</div>
		</div>
	</div>
















{% endblock content %}